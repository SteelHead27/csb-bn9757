(this["webpackJsonpchat-application"]=this["webpackJsonpchat-application"]||[]).push([[0],{46:function(e,t,c){},47:function(e,t,c){"use strict";c.r(t);var n=c(5),a=c.n(n),s=c(36),r=c.n(s),i=c(12),j=c(37),u=c(22),o=c(24),b=c(14),d=(Object(j.a)({apiKey:"AIzaSyB6eiocRt84rS714g48Cbdu5kSffapLE2Q",authDomain:"chatapplication-ee580.firebaseapp.com",projectId:"chatapplication-ee580",storageBucket:"chatapplication-ee580.appspot.com",messagingSenderId:"978091730307",appId:"1:978091730307:web:2c4951097b4556504f82b6",measurementId:"G-1LZDPJ0YF6"}),Object(u.b)()),l=Object(o.b)(),O=Object(b.g)(),p=c(8),h=Object(n.createContext)(),x=function(e){var t=e.children,c=Object(n.useState)({}),a=Object(i.a)(c,2),s=a[0],r=a[1];return Object(n.useEffect)((function(){var e=Object(u.c)(d,(function(e){r(e),console.log(e)}));return function(){e()}}),[]),Object(p.jsx)(h.Provider,{value:{currentUser:s},children:t})},f=function(){var e=Object(n.useContext)(h).currentUser;return Object(p.jsxs)("div",{className:"navbar",children:[Object(p.jsx)("span",{className:"logo",children:"Chat application"}),Object(p.jsxs)("div",{className:"user",children:[Object(p.jsx)("img",{src:e.photoURL,alt:""}),Object(p.jsx)("k",{children:e.displayName})]})]})},m=c(4),v=c(0),g=c(1),A=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(null),r=Object(i.a)(s,2),j=r[0],u=r[1],o=Object(n.useState)(!1),d=Object(i.a)(o,2),l=d[0],x=d[1],f=Object(n.useContext)(h).currentUser,A=function(){var e=Object(g.a)(Object(v.a)().mark((function e(){var t;return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(b.i)(Object(b.c)(O,"users"),Object(b.m)("displayName","==",c)),e.prev=1,e.next=4,Object(b.f)(t);case 4:e.sent.forEach((function(e){u(e.data())})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),x(!0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=Object(g.a)(Object(v.a)().mark((function e(){var t,c,n;return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=f.uid>j.uid?f.uid+j.uid:j.uid+f.uid,e.prev=1,e.next=4,Object(b.e)(Object(b.d)(O,"chats",t));case 4:if(e.sent.exists()){e.next=12;break}return e.next=8,Object(b.k)(Object(b.d)(O,"chats",t),{messages:[]});case 8:return e.next=10,Object(b.l)(Object(b.d)(O,"userChats",f.uid),(c={},Object(m.a)(c,t+".userInfo",{uid:j.uid,displayName:j.displayName,photoURL:j.photoURL}),Object(m.a)(c,t+".date",Object(b.j)()),c));case 10:return e.next=12,Object(b.l)(Object(b.d)(O,"userChats",j.uid),(n={},Object(m.a)(n,t+".userInfo",{uid:f.uid,displayName:f.displayName,photoURL:f.photoURL}),Object(m.a)(n,t+".date",Object(b.j)()),n));case 12:e.next=16;break;case 14:e.prev=14,e.t0=e.catch(1);case 16:u(null),a("");case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"search",children:[Object(p.jsx)("div",{className:"searchForm",children:Object(p.jsx)("input",{type:"text",placeholder:"Find a user",onKeyDown:function(e){"Enter"===e.code&&A()},onChange:function(e){return a(e.target.value)},value:c})}),l&&Object(p.jsx)("span",{children:"User not found!"}),j&&Object(p.jsxs)("div",{className:"userChat",onClick:C,children:[Object(p.jsx)("img",{src:j.photoURL,alt:""}),Object(p.jsx)("div",{className:"userChatInfo",children:Object(p.jsx)("span",{children:j.displayName})})]})]})},C=Object(n.createContext)(),y=function(e){var t=e.children,c=Object(n.useContext)(h).currentUser,a=Object(n.useReducer)((function(e,t){return"CHANGE_USER"===t.type?{user:t.payload,chatId:c.uid>t.payload.uid?c.uid+t.payload.uid:t.payload.uid+c.uid}:e}),{chatId:"null",user:{}}),s=Object(i.a)(a,2),r=s[0],j=s[1];return Object(p.jsx)(C.Provider,{value:{data:r,dispatch:j},children:t})},N=function(){var e,t=Object(n.useState)([]),c=Object(i.a)(t,2),a=c[0],s=c[1],r=Object(n.useContext)(h).currentUser,j=Object(n.useContext)(C).dispatch;Object(n.useEffect)((function(){r.uid&&function(){var e=Object(b.h)(Object(b.d)(O,"userChats",r.uid),(function(e){s(e.data())}))}()}),[r.uid]);return Object(p.jsx)("div",{className:"chats",children:null===(e=Object.entries(a))||void 0===e?void 0:e.sort((function(e,t){return t[1].date-e[1].date})).map((function(e){var t;return Object(p.jsxs)("div",{className:"userChat",onClick:function(){return t=e[1].userInfo,void j({type:"CHANGE_USER",payload:t});var t},children:[Object(p.jsx)("img",{src:e[1].userInfo.photoURL,alt:""}),Object(p.jsxs)("div",{className:"userChatInfo",children:[Object(p.jsx)("span",{children:e[1].userInfo.displayName}),Object(p.jsx)("p",{children:null===(t=e[1].lastMessage)||void 0===t?void 0:t.text})]})]},e[0])}))})},w=function(){return Object(p.jsxs)("div",{className:"sidebar",children:[Object(p.jsx)(f,{}),Object(p.jsx)(A,{}),Object(p.jsx)(N,{})]})},I=function(e){var t=e.message,c=Object(n.useContext)(h).currentUser,a=Object(n.useContext)(C).data,s=Object(n.useRef)();return Object(n.useEffect)((function(){var e;null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}),[t]),Object(p.jsxs)("div",{ref:s,className:"message ".concat(t.senderId===c.uid&&"owner"),children:[Object(p.jsxs)("div",{className:"messageInfo",children:[Object(p.jsx)("img",{src:t.senderId===c.uid?c.photoURL:a.user.photoURL,alt:""}),Object(p.jsx)("span",{children:"just now"})]}),Object(p.jsxs)("div",{className:"messageContent",children:[Object(p.jsx)("p",{children:t.text}),t.img&&Object(p.jsx)("img",{src:t.img,alt:""})]})]})},S=function(){var e=Object(n.useState)([]),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(n.useContext)(C).data;return Object(n.useEffect)((function(){var e=Object(b.h)(Object(b.d)(O,"chats",s.chatId),(function(e){e.exists()&&a(e.data().messages)}));return function(){e()}}),[s.chatId]),console.log(c),Object(p.jsx)("div",{className:"messages",children:c.map((function(e){return Object(p.jsx)(I,{message:e},e.id)}))})},U=c(49),k=function(){var e=Object(n.useState)(""),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(null),r=Object(i.a)(s,2),j=r[0],u=r[1],d=Object(n.useContext)(h).currentUser,x=Object(n.useContext)(C).data,f=function(){var e=Object(g.a)(Object(v.a)().mark((function e(){var t,n,s,r;return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!j){e.next=6;break}s=Object(o.c)(l,Object(U.a)()),(r=Object(o.d)(s,j)).on((function(e){}),(function(){Object(o.a)(r.snapshot.ref).then(function(){var e=Object(g.a)(Object(v.a)().mark((function e(t){return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(b.l)(Object(b.d)(O,"chats",x.chatId),{messages:Object(b.b)({id:Object(U.a)(),text:c,senderId:d.uid,date:b.a.now(),img:t})});case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),e.next=8;break;case 6:return e.next=8,Object(b.l)(Object(b.d)(O,"chats",x.chatId),{messages:Object(b.b)({id:Object(U.a)(),text:c,senderId:d.uid,date:b.a.now()})});case 8:return e.next=10,Object(b.l)(Object(b.d)(O,"userChats",d.uid),(t={},Object(m.a)(t,x.chatId+".lastMessage",{text:c}),Object(m.a)(t,x.chatId+".date",Object(b.j)()),t));case 10:return e.next=12,Object(b.l)(Object(b.d)(O,"userChats",x.user.uid),(n={},Object(m.a)(n,x.chatId+".lastMessage",{text:c}),Object(m.a)(n,x.chatId+".date",Object(b.j)()),n));case 12:a(""),u(null);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(p.jsxs)("div",{className:"input",children:[Object(p.jsx)("input",{type:"text",placeholder:"Type something...",onChange:function(e){return a(e.target.value)},value:c}),Object(p.jsxs)("div",{className:"send",children:[Object(p.jsx)("input",{type:"file",style:{display:"none"},id:"file",onChange:function(e){return u(e.target.files[0])}}),Object(p.jsx)("label",{htmlFor:"file",children:Object(p.jsx)("img",{src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgEAQAAACJ4248AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABhElEQVR42mNgGAUkgI1Wfn7rp+zfv970yxcwnrJ//wYTX1+6WL7+UFvb+vX//2PF6q2ttPc5yKKzP39uSCsvXycsKbnRSkpq/c6yMpAYxBE+PrTzPSjY1///D7IcXQ4kBnHAvn20cwAovtf//79qlYQEuhxIDOyAmZ8+0c4B0LgmV57qDlife/To+leHDxMrT30HkMgfdcCoA0YdMOqAUQcMQwc0PX0K4q97Z2MDwmD5pqdP6ecAvo4O9GbZhqj2dto5YOanT+AGyUoeHnAjZCUbG9gRoJAAYb6ODpAYpPnGy0v1Bsr6OefPgw397+BASO26LicnsFqLc+eo54AHzc1gQ0s3bSKkdkPUli3gKJnX2Eg1B6zrEhODRcMGp6oqnOouV1dDQurDh81GIiJUbZZtOBQSsj7u3z+wBS82b95o5egIShMgDAp2mM9BatZdDgqiSdsQ7AiXjx9xdlD+f/hAM8vhzfCVoqLrnZqaNgifPbv+3efPYLz+zBlQnFM92EcEAADPUaJSrNsJswAAAABJRU5ErkJggg==",alt:""})}),Object(p.jsx)("button",{onClick:f,children:"Send"})]})]})},E=function(){var e,t=Object(n.useContext)(C).data;return Object(p.jsxs)("div",{className:"chat",children:[Object(p.jsxs)("div",{className:"chatInfo",children:[Object(p.jsx)("span",{children:null===(e=t.user)||void 0===e?void 0:e.displayName}),Object(p.jsx)("div",{className:"chatIcons",children:Object(p.jsx)("t",{onClick:function(){return Object(u.e)(d)},children:"logout"})})]}),Object(p.jsx)(S,{}),Object(p.jsx)(k,{})]})},R=function(){return Object(p.jsx)("div",{className:"home",children:Object(p.jsxs)("div",{className:"container",children:[Object(p.jsx)(w,{}),Object(p.jsx)(E,{})]})})},L=c(13),B=c(27),D=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(L.m)(),r=function(){var e=Object(g.a)(Object(v.a)().mark((function e(t){var c,n;return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),c=t.target[0].value,n=t.target[1].value,e.prev=3,e.next=6,Object(u.d)(d,c,n);case 6:s("/"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(3),a(!0);case 12:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"formContainer",children:Object(p.jsxs)("div",{className:"formWrapper",children:[Object(p.jsx)("span",{className:"logo",children:"Chat application"}),Object(p.jsx)("span",{className:"title",children:"Login"}),Object(p.jsxs)("form",{onSubmit:r,children:[Object(p.jsx)("input",{type:"email",placeholder:"email"}),Object(p.jsx)("input",{type:"password",placeholder:"password"}),Object(p.jsx)("button",{children:"Sign in"}),c&&Object(p.jsx)("span",{children:"Something went wrong"})]}),Object(p.jsxs)("p",{children:["You don't have an account? ",Object(p.jsx)(B.b,{to:"/register",children:"Register"})]})]})})},P=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),c=t[0],a=t[1],s=Object(n.useState)(!1),r=Object(i.a)(s,2),j=r[0],h=r[1],x=Object(L.m)(),f=function(){var e=Object(g.a)(Object(v.a)().mark((function e(t){var c,n,s,r,i,j,p;return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),t.preventDefault(),c=t.target[0].value,n=t.target[1].value,s=t.target[2].value,r=t.target[3].files[0],e.prev=6,e.next=9,Object(u.a)(d,n,s);case 9:return i=e.sent,j=(new Date).getTime(),p=Object(o.c)(l,"".concat(c+j)),e.next=14,Object(o.d)(p,r).then((function(){Object(o.a)(p).then(function(){var e=Object(g.a)(Object(v.a)().mark((function e(t){return Object(v.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(u.f)(i.user,{displayName:c,photoURL:t});case 3:return e.next=5,Object(b.k)(Object(b.d)(O,"users",i.user.uid),{uid:i.user.uid,displayName:c,email:n,photoURL:t});case 5:return e.next=7,Object(b.k)(Object(b.d)(O,"userChats",i.user.uid),{});case 7:x("/"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),a(!0),h(!1);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}())}));case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(6),a(!0),h(!1);case 20:case"end":return e.stop()}}),e,null,[[6,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(p.jsx)("div",{className:"formContainer",children:Object(p.jsxs)("div",{className:"formWrapper",children:[Object(p.jsx)("span",{className:"logo",children:"Chat application"}),Object(p.jsx)("span",{className:"title",children:"Register"}),Object(p.jsxs)("form",{onSubmit:f,children:[Object(p.jsx)("input",{required:!0,type:"text",placeholder:"display name"}),Object(p.jsx)("input",{required:!0,type:"email",placeholder:"email"}),Object(p.jsx)("input",{required:!0,type:"password",placeholder:"password"}),Object(p.jsx)("input",{required:!0,type:"file",id:"file"}),Object(p.jsx)("button",{disabled:j,children:"Sign up"}),j&&"Uploading and compressing the image please wait...",c&&Object(p.jsx)("span",{children:"Something went wrong"})]}),Object(p.jsxs)("p",{children:["You do have an account? ",Object(p.jsx)(B.b,{to:"/register",children:"Login"})]})]})})};c(46);var q=function(){var e=Object(n.useContext)(h).currentUser,t=function(t){var c=t.children;return e?c:Object(p.jsx)(L.a,{to:"/login"})};return Object(p.jsx)(B.a,{children:Object(p.jsx)(L.d,{children:Object(p.jsxs)(L.b,{path:"/",children:[Object(p.jsx)(L.b,{index:!0,element:Object(p.jsx)(t,{children:Object(p.jsx)(R,{})})}),Object(p.jsx)(L.b,{path:"login",element:Object(p.jsx)(D,{})}),Object(p.jsx)(L.b,{path:"register",element:Object(p.jsx)(P,{})})]})})})};r.a.createRoot(document.getElementById("root")).render(Object(p.jsx)(x,{children:Object(p.jsx)(y,{children:Object(p.jsx)(a.a.StrictMode,{children:Object(p.jsx)(q,{})})})}))}},[[47,1,2]]]);
//# sourceMappingURL=main.3ed8dc11.chunk.js.map